---
title: "Taller Interactivo — Demo"
format:
  html:
    toc: true
---

> **Requisito:** El servidor backend debe estar activo en `http://localhost:8000`.
> Consulta el `README.md` del backend para instrucciones de arranque.

---

## Problema 1 · Suma de componentes de un vector

Crea un vector NumPy con los valores $[1,\ 2,\ 3]$ e imprime la **suma de sus componentes**.

*Pista:* usa `np.array(...)` y el método `.sum()`.

```{=html}
<div id="code-problem-numpy_sum" class="interactive-problem">
  <div class="problem-header">
    <span class="problem-badge">⌨ Código Python</span>
    <h4>Suma de componentes — NumPy</h4>
  </div>

  <div class="problem-description">
    Escribe código Python que:<br>
    1. Importe NumPy como <code>np</code>.<br>
    2. Cree el vector <code>v = [1, 2, 3]</code>.<br>
    3. Imprima la suma de sus componentes (resultado esperado: <strong>6</strong>).
  </div>

  <div class="code-editor-container">
    <label for="code-input-numpy_sum">Tu solución</label>
    <textarea id="code-input-numpy_sum" class="code-editor-input" spellcheck="false">import numpy as np
v = np.array([1, 2, 3])
print(v.sum())</textarea>
  </div>

  <div class="problem-controls">
    <button class="btn btn-primary" onclick="submitCode('numpy_sum')">▶ Ejecutar y verificar</button>
    <button class="btn btn-secondary" onclick="resetCodeDemo('numpy_sum')">↺ Restablecer</button>
    <span id="loading-numpy_sum" class="loading hidden">Ejecutando…</span>
  </div>

  <div id="feedback-numpy_sum" class="feedback-container hidden">
    <div id="feedback-status-numpy_sum"  class="feedback-status"></div>
    <div id="feedback-message-numpy_sum" class="feedback-message"></div>
    <div id="feedback-output-numpy_sum"  class="feedback-output"></div>
  </div>
</div>
```

---

## Problema 2 · Producto punto

Calcula el **producto punto** de los vectores $\mathbf{u} = (1,\ 2)$ y $\mathbf{v} = (3,\ 4)$.

$$\mathbf{u} \cdot \mathbf{v} = u_1 v_1 + u_2 v_2 = 1{\times}3 + 2{\times}4$$

```{=html}
<div id="math-problem-dot_product" class="interactive-problem">
  <div class="problem-header">
    <span class="problem-badge">∑ Respuesta matemática</span>
    <h4>Producto punto de dos vectores</h4>
  </div>

  <div class="problem-description">
    Escribe el resultado numérico del producto punto
    <strong>u·v</strong> donde <strong>u = (1, 2)</strong> y <strong>v = (3, 4)</strong>.
  </div>

  <div class="answer-input-container">
    <label for="answer-input-dot_product">Tu respuesta</label>
    <input
      type="text"
      id="answer-input-dot_product"
      class="answer-input"
      placeholder="Escribe el resultado aquí…"
      onkeydown="if(event.key==='Enter') submitMath('dot_product')"
    >
  </div>

  <div class="problem-controls">
    <button class="btn btn-primary" onclick="submitMath('dot_product')">✓ Verificar respuesta</button>
    <button class="btn btn-secondary" onclick="resetMath('dot_product')">↺ Limpiar</button>
    <span id="loading-math-dot_product" class="loading hidden">Verificando…</span>
  </div>

  <div id="feedback-math-dot_product" class="feedback-container hidden">
    <div id="feedback-status-math-dot_product"  class="feedback-status"></div>
    <div id="feedback-message-math-dot_product" class="feedback-message"></div>
  </div>
</div>
```

---

## Problema 3 · Determinante de una matriz

Calcula el **determinante** de la matriz:

$$M = \begin{pmatrix} 1 & 2 \\ 3 & 4 \end{pmatrix}$$

*Pista:* usa `np.linalg.det(M)`. El resultado debe ser **−2**.

```{=html}
<div id="code-problem-matrix_det" class="interactive-problem">
  <div class="problem-header">
    <span class="problem-badge">⌨ Código Python</span>
    <h4>Determinante de una matriz 2×2</h4>
  </div>

  <div class="problem-description">
    Usa NumPy para crear la matriz
    <strong>M = [[1, 2], [3, 4]]</strong>
    y calcula e imprime su determinante.<br>
    Resultado esperado: <strong>−2</strong>.
  </div>

  <div class="code-editor-container">
    <label for="code-input-matrix_det">Tu solución</label>
    <textarea id="code-input-matrix_det" class="code-editor-input" spellcheck="false">import numpy as np
M = np.array([[1, 2], [3, 4]])
det = np.linalg.det(M)
print(round(det))</textarea>
  </div>

  <div class="problem-controls">
    <button class="btn btn-primary" onclick="submitCode('matrix_det')">▶ Ejecutar y verificar</button>
    <button class="btn btn-secondary" onclick="resetCodeDemo('matrix_det')">↺ Restablecer</button>
    <span id="loading-matrix_det" class="loading hidden">Ejecutando…</span>
  </div>

  <div id="feedback-matrix_det" class="feedback-container hidden">
    <div id="feedback-status-matrix_det"  class="feedback-status"></div>
    <div id="feedback-message-matrix_det" class="feedback-message"></div>
    <div id="feedback-output-matrix_det"  class="feedback-output"></div>
  </div>
</div>
```

---

## ¿Cómo funciona?

1. **Escribe tu solución** en el editor de código o en el campo de respuesta.
2. **Haz clic en "Ejecutar y verificar"** — tu código se envía al servidor y se evalúa automáticamente.
3. **Recibe retroalimentación inmediata**: verás si tu resultado es correcto y, si no, qué se esperaba.

```{=html}
<script>
const API_BASE_URL = 'http://localhost:8000/api/v1';

/* ── helpers ── */
function _showStatus(el, type, text) {
  el.className = 'feedback-status ' + type;
  el.textContent = text;
}

/* ── código ── */
async function submitCode(problemId) {
  const textarea  = document.getElementById('code-input-' + problemId);
  const feedback  = document.getElementById('feedback-' + problemId);
  const statusEl  = document.getElementById('feedback-status-' + problemId);
  const messageEl = document.getElementById('feedback-message-' + problemId);
  const outputEl  = document.getElementById('feedback-output-' + problemId);
  const loadingEl = document.getElementById('loading-' + problemId);
  const submitBtn = feedback.closest('.interactive-problem').querySelector('.btn-primary');

  const code = textarea.value.trim();

  if (!code) {
    _showStatus(statusEl, 'error', '⚠ Por favor escribe tu código antes de enviar.');
    messageEl.textContent = '';
    outputEl.textContent  = '';
    feedback.classList.remove('hidden');
    return;
  }

  loadingEl.classList.remove('hidden');
  feedback.classList.add('hidden');
  submitBtn.disabled = true;

  try {
    const res = await fetch(API_BASE_URL + '/submit/code', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ problem_id: problemId, code: code, user_id: null }),
    });

    if (!res.ok) {
      const detail = await res.json().catch(function() { return {}; });
      throw new Error(detail.detail || 'Error del servidor (' + res.status + ')');
    }

    const data = await res.json();

    _showStatus(
      statusEl,
      data.is_correct ? 'correct' : 'incorrect',
      data.is_correct ? '✓ ¡Correcto!' : '✗ Respuesta incorrecta'
    );
    messageEl.textContent = data.feedback || '';

    if (data.execution_output) {
      outputEl.textContent = '$ Salida:\n' + data.execution_output;
    } else if (data.execution_error) {
      outputEl.textContent = '$ Error:\n' + data.execution_error;
    } else {
      outputEl.textContent = '';
    }

  } catch (err) {
    _showStatus(statusEl, 'error', '⚠ No se pudo conectar al servidor');
    messageEl.textContent = err.message + '\n\nAsegúrate de que el backend está corriendo en http://localhost:8000';
    outputEl.textContent = '';
  } finally {
    loadingEl.classList.add('hidden');
    submitBtn.disabled = false;
    feedback.classList.remove('hidden');
  }
}

var _initialCode = {};
document.querySelectorAll('.code-editor-input').forEach(function(ta) {
  var id = ta.id.replace('code-input-', '');
  _initialCode[id] = ta.value;
});

function resetCodeDemo(problemId) {
  document.getElementById('code-input-' + problemId).value = _initialCode[problemId] || '';
  document.getElementById('feedback-' + problemId).classList.add('hidden');
}

/* ── matemática ── */
async function submitMath(problemId) {
  var input     = document.getElementById('answer-input-' + problemId);
  var feedback  = document.getElementById('feedback-math-' + problemId);
  var statusEl  = document.getElementById('feedback-status-math-' + problemId);
  var messageEl = document.getElementById('feedback-message-math-' + problemId);
  var loadingEl = document.getElementById('loading-math-' + problemId);
  var submitBtn = feedback.closest('.interactive-problem').querySelector('.btn-primary');

  var answer = input.value.trim();

  if (!answer) {
    _showStatus(statusEl, 'error', '⚠ Por favor escribe tu respuesta antes de verificar.');
    messageEl.textContent = '';
    feedback.classList.remove('hidden');
    return;
  }

  loadingEl.classList.remove('hidden');
  feedback.classList.add('hidden');
  submitBtn.disabled = true;

  try {
    var res = await fetch(API_BASE_URL + '/submit/math', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ problem_id: problemId, answer: answer, user_id: null }),
    });

    if (!res.ok) {
      var detail = await res.json().catch(function() { return {}; });
      throw new Error(detail.detail || 'Error del servidor (' + res.status + ')');
    }

    var data = await res.json();

    _showStatus(
      statusEl,
      data.is_correct ? 'correct' : 'incorrect',
      data.is_correct ? '✓ ¡Correcto!' : '✗ Respuesta incorrecta'
    );
    messageEl.textContent = data.feedback || '';

  } catch (err) {
    _showStatus(statusEl, 'error', '⚠ No se pudo conectar al servidor');
    messageEl.textContent = err.message;
  } finally {
    loadingEl.classList.add('hidden');
    submitBtn.disabled = false;
    feedback.classList.remove('hidden');
  }
}

function resetMath(problemId) {
  document.getElementById('answer-input-' + problemId).value = '';
  document.getElementById('feedback-math-' + problemId).classList.add('hidden');
}
</script>
```
